<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus CRM | Client Management Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .tab-active {
            background-color: #eef2ff;
            color: #4f46e5;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* Tour Highlight Style */
        .tour-highlight {
            position: relative;
            z-index: 1001 !important;
            box-shadow: 0 0 0 9999px rgba(15, 23, 42, 0.75), 0 0 15px rgba(79, 70, 229, 0.5);
            pointer-events: none;
            border-radius: 0.75rem;
        }

        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.26, 0.53, 0.74, 1.48);
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen overflow-hidden">

    <div id="app" class="flex h-screen w-full">
        <!-- Sidebar -->
        <aside id="tour-sidebar" class="w-64 bg-white border-r border-slate-200 flex flex-col shrink-0">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-xl">
                    <i data-lucide="shield-check" class="text-white w-6 h-6"></i>
                </div>
                <h1 class="text-xl font-extrabold tracking-tight text-slate-800 italic">NEXUS</h1>
            </div>

            <nav class="flex-1 px-4 py-4 space-y-1">
                <button onclick="router.navigate('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-50 hover:text-slate-900">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
                </button>
                <button onclick="router.navigate('directory')" id="nav-directory" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-50 hover:text-slate-900">
                    <i data-lucide="users" class="w-5 h-5"></i> Client Directory
                </button>
                <button onclick="router.navigate('settings')" id="nav-settings" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-50 hover:text-slate-900">
                    <i data-lucide="database" class="w-5 h-5"></i> Demo Settings
                </button>
            </nav>

            <div class="p-6 border-t border-slate-100">
                <div class="bg-slate-50 rounded-2xl p-4">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Demo Mode</p>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></div>
                        <p class="text-xs font-bold text-slate-700">Static Session</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden relative">
            <!-- Header -->
            <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 px-8 py-4 flex items-center justify-between z-10">
                <div id="tour-search" class="relative w-96">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                    <input 
                        type="text" 
                        id="globalSearch"
                        oninput="ui.handleSearch(this.value)"
                        class="w-full bg-slate-100 border-none rounded-full pl-10 pr-4 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500 transition-all outline-none"
                        placeholder="Search name, email, PAN, Aadhar..."
                    >
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="tour.start()" class="text-indigo-600 border border-indigo-200 px-4 py-2.5 rounded-xl text-sm font-bold flex items-center gap-2 hover:bg-indigo-50 transition-all">
                        <i data-lucide="map" class="w-4 h-4"></i> Take a Tour
                    </button>
                    <button id="tour-add-btn" onclick="ui.toggleModal('addClientModal', true)" class="bg-indigo-600 text-white px-6 py-2.5 rounded-xl text-sm font-bold flex items-center gap-2 hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100">
                        <i data-lucide="plus" class="w-5 h-5"></i> Add Client
                    </button>
                </div>
            </header>

            <!-- Scrollable Viewport -->
            <main id="viewport" class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                <!-- Content injected here via router -->
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="addClientModal" class="fixed inset-0 z-[1050] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm hidden animate-in fade-in duration-300">
        <div class="bg-white rounded-[2.5rem] w-full max-w-2xl overflow-hidden shadow-2xl animate-pop">
            <div class="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <div>
                    <h2 class="text-2xl font-black text-slate-800 tracking-tight">Onboard New Client</h2>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Direct Registration</p>
                </div>
                <button onclick="ui.toggleModal('addClientModal', false)" class="p-3 text-slate-300 hover:text-slate-800 hover:bg-white rounded-2xl transition-all">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form id="addClientForm" onsubmit="ui.submitNewClient(event)" class="p-10 grid grid-cols-2 gap-6 max-h-[60vh] overflow-y-auto custom-scrollbar">
                <div class="col-span-2 space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Full Legal Name</label>
                    <input name="name" required type="text" placeholder="e.g. Vikram Singh" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Email Address</label>
                    <input name="email" required type="email" placeholder="vikram@corp.com" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Phone Number</label>
                    <input name="phone" required type="text" placeholder="+91 98XXX XXXXX" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">PAN Number</label>
                    <input name="pan" required type="text" placeholder="ABCDE1234F" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Aadhar Number</label>
                    <input name="aadhar" required type="text" placeholder="XXXX XXXX XXXX" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">City</label>
                    <input name="city" required type="text" placeholder="Mumbai" class="w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-2 ring-indigo-500 outline-none">
                </div>
                <div class="col-span-2 flex justify-end gap-4 pt-6">
                    <button type="button" onclick="ui.toggleModal('addClientModal', false)" class="px-8 py-3 text-xs font-black text-slate-400 hover:text-slate-800 uppercase tracking-widest">Discard</button>
                    <button type="submit" class="bg-indigo-600 text-white px-10 py-3 rounded-2xl text-xs font-black shadow-2xl shadow-indigo-200 hover:bg-indigo-700 transition-all uppercase tracking-widest">Register Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tour Guide Card -->
    <div id="tour-guide" class="fixed z-[1002] bg-white rounded-3xl shadow-2xl p-6 w-80 border border-slate-200 hidden transform scale-0 transition-transform duration-300">
        <div class="flex items-center gap-3 mb-4">
            <div class="bg-indigo-600 text-white p-2 rounded-lg"><i data-lucide="map-pin" class="w-4 h-4"></i></div>
            <h4 id="tour-title" class="font-black text-slate-800 uppercase text-xs tracking-widest">Quick Tour</h4>
        </div>
        <p id="tour-text" class="text-sm text-slate-600 leading-relaxed mb-6 font-medium">Welcome to the CRM walkthrough!</p>
        <div class="flex justify-between items-center border-t border-slate-100 pt-4">
            <button id="tour-prev" onclick="tour.prev()" class="text-xs font-bold text-slate-400 hover:text-slate-800">Back</button>
            <div class="flex gap-2">
                <button id="tour-skip" onclick="tour.stop()" class="text-xs font-bold text-slate-400 hover:text-slate-800 px-3">Skip</button>
                <button id="tour-next" onclick="tour.next()" class="bg-indigo-600 text-white px-5 py-2 rounded-xl text-xs font-black shadow-lg shadow-indigo-100">Next</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-8 right-8 z-[1100] transform translate-y-20 transition-transform duration-300 pointer-events-none">
        <div class="bg-slate-800 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3">
            <i data-lucide="check-circle" class="text-emerald-400 w-5 h-5"></i>
            <span id="toastMessage" class="text-sm font-bold">Action successful</span>
        </div>
    </div>

    <script>
        // --- Deterministic Static Data ---
        const STATIC_CLIENTS = [
            { id: 'sc-1', name: 'Arjun Mehta', email: 'arjun.mehta@reliance.in', phone: '+91 98200 12345', pan: 'ARJPM1234F', aadhar: '5566 7788 9900', city: 'Mumbai', billingAmount: 185000, status: 'Active', nextMeeting: 'Jan 15, 2026' },
            { id: 'sc-2', name: 'Priya Chawla', email: 'p.chawla@gmail.com', phone: '+91 99300 56789', pan: 'PRIAC5678K', aadhar: '1122 3344 5566', city: 'Delhi', billingAmount: 95000, status: 'Active', nextMeeting: 'Feb 02, 2026' },
            { id: 'sc-3', name: 'Kabir Das', email: 'k.das@outlook.com', phone: '+91 70450 11223', pan: 'KABDC9012L', aadhar: '9988 7766 5544', city: 'Kolkata', billingAmount: 42000, status: 'Active', nextMeeting: 'Jan 28, 2026' },
            { id: 'sc-4', name: 'Anjali Reddy', email: 'anjali.r@reddy-logistics.com', phone: '+91 88790 44556', pan: 'ANJRC3456M', aadhar: '4455 6677 8899', city: 'Hyderabad', billingAmount: 215000, status: 'Active', nextMeeting: 'Mar 12, 2026' },
            { id: 'sc-5', name: 'Siddharth Nair', email: 'sid.n@nair-associates.com', phone: '+91 91234 56789', pan: 'SIDNC7890N', aadhar: '2233 4455 6677', city: 'Bangalore', billingAmount: 112000, status: 'Active', nextMeeting: 'Jan 20, 2026' },
            { id: 'sc-6', name: 'Ishita Verma', email: 'iverma@tech-park.com', phone: '+91 99887 76655', pan: 'ISHVC1234P', aadhar: '8877 6655 4433', city: 'Pune', billingAmount: 78000, status: 'Inactive', nextMeeting: 'Jan 30, 2026' },
            { id: 'sc-7', name: 'Rohan Gupta', email: 'rohan.g@gupta-infra.in', phone: '+91 77665 44332', pan: 'ROHGC5678Q', aadhar: '6655 4433 2211', city: 'Ahmedabad', billingAmount: 320000, status: 'Active', nextMeeting: 'Feb 15, 2026' },
            { id: 'sc-8', name: 'Meera Iyer', email: 'meera.i@iyer-legal.com', phone: '+91 88000 11000', pan: 'MEEIC9012R', aadhar: '3344 5566 7788', city: 'Chennai', billingAmount: 55000, status: 'Active', nextMeeting: 'Jan 24, 2026' }
        ];

        // --- State Management ---
        const state = {
            clients: [...STATIC_CLIENTS],
            activeTab: 'dashboard',
            searchQuery: '',
            selectedClientId: null,
            viewingTab: 'overview'
        };

        // --- Tour Manager ---
        const tour = {
            active: false,
            step: 0,
            steps: [
                { target: 'tour-sidebar', title: 'Navigation', text: 'This is your command center. Toggle between the Dashboard, Client Directory, and Settings.', pos: 'right' },
                { target: 'tour-search', title: 'Smart Search', text: 'Instantly find any client using their Name, Email, PAN number, or Aadhar digits.', pos: 'bottom' },
                { target: 'tour-add-btn', title: 'Onboarding', text: 'Add a new client record manually here. It takes less than a minute.', pos: 'bottom' },
                { target: 'nav-settings', title: 'Demo Data', text: 'Want to see 100 clients? Head over to settings to seed your database with static test data.', pos: 'right', nav: 'settings' },
                { target: 'nav-directory', title: 'Managing Clients', text: 'Let\'s view the directory to see how data is organized and compliant.', pos: 'right', nav: 'directory' }
            ],
            start() {
                this.active = true;
                this.step = 0;
                this.show();
            },
            stop() {
                this.active = false;
                document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
                document.getElementById('tour-guide').classList.add('hidden');
                document.getElementById('tour-guide').classList.remove('scale-100');
            },
            next() {
                if (this.step < this.steps.length - 1) {
                    this.step++;
                    this.show();
                } else {
                    this.stop();
                    ui.showToast('Tour Complete!');
                }
            },
            prev() {
                if (this.step > 0) {
                    this.step--;
                    this.show();
                }
            },
            show() {
                const step = this.steps[this.step];
                if (step.nav) router.navigate(step.nav);
                
                document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
                const targetEl = document.getElementById(step.target);
                if (!targetEl) return;
                
                targetEl.classList.add('tour-highlight');
                
                const guide = document.getElementById('tour-guide');
                const title = document.getElementById('tour-title');
                const text = document.getElementById('tour-text');
                
                title.textContent = step.title;
                text.textContent = step.text;
                
                guide.classList.remove('hidden');
                setTimeout(() => guide.classList.add('scale-100'), 50);

                const rect = targetEl.getBoundingClientRect();
                if (step.pos === 'right') {
                    guide.style.top = rect.top + 'px';
                    guide.style.left = (rect.right + 20) + 'px';
                } else if (step.pos === 'bottom') {
                    guide.style.top = (rect.bottom + 20) + 'px';
                    guide.style.left = rect.left + 'px';
                }
                
                document.getElementById('tour-prev').classList.toggle('invisible', this.step === 0);
                document.getElementById('tour-next').textContent = (this.step === this.steps.length - 1) ? 'Finish' : 'Next';
            }
        };

        // --- Router ---
        const router = {
            navigate(view, clientId = null) {
                state.activeTab = view;
                state.selectedClientId = clientId;
                
                // Reset search logic if navigating away manually
                if (!clientId && state.searchQuery === '') {
                    // Do nothing
                }

                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('tab-active'));
                const activeNav = document.getElementById(`nav-${view}`);
                if (activeNav) activeNav.classList.add('tab-active');
                this.render();
            },
            render() {
                const viewport = document.getElementById('viewport');
                viewport.innerHTML = '';
                if (state.selectedClientId) {
                    viewport.appendChild(views.clientDetail(state.selectedClientId));
                } else {
                    switch(state.activeTab) {
                        case 'dashboard': viewport.appendChild(views.dashboard()); break;
                        case 'directory': viewport.appendChild(views.directory()); break;
                        case 'settings': viewport.appendChild(views.settings()); break;
                    }
                }
                lucide.createIcons();
            }
        };

        // --- Views ---
        const views = {
            dashboard() {
                const div = document.createElement('div');
                div.className = 'space-y-8 animate-in fade-in duration-500';
                const stats = {
                    total: state.clients.length,
                    active: state.clients.filter(c => c.status === 'Active').length,
                    revenue: state.clients.reduce((acc, c) => acc + (Number(c.billingAmount) || 0), 0),
                    upcoming: state.clients.filter(c => c.nextMeeting && new Date(c.nextMeeting) >= new Date()).length
                };
                div.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${this.statCard('Portfolio', stats.total, 'Total clients', 'users', 'text-blue-500')}
                        ${this.statCard('Status', stats.active, 'Active accounts', 'check-circle', 'text-emerald-500')}
                        ${this.statCard('Est. ARR', '₹' + (stats.revenue/100000).toFixed(1) + 'L', 'Projected income', 'credit-card', 'text-amber-500')}
                        ${this.statCard('Scheduled', stats.upcoming, 'Meetings planned', 'calendar', 'text-purple-500')}
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white rounded-[2rem] border border-slate-200 p-8 shadow-sm">
                            <h3 class="font-black text-xl text-slate-800 mb-8">Recently Active Clients</h3>
                            <div class="space-y-2">
                                ${state.clients.slice(0, 5).map(c => `
                                    <div onclick="router.navigate('directory', '${c.id}')" class="flex items-center justify-between p-4 rounded-2xl hover:bg-slate-50 transition-all cursor-pointer group">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 rounded-2xl bg-slate-100 flex items-center justify-center text-sm font-black text-slate-500 group-hover:bg-indigo-600 group-hover:text-white transition-all">${c.name.charAt(0)}</div>
                                            <div><p class="text-sm font-black text-slate-800">${c.name}</p><p class="text-xs text-slate-400 font-medium">${c.city}</p></div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-[10px] font-black text-slate-300 uppercase mb-1">Billing Value</p>
                                            <span class="text-sm font-bold text-slate-700">₹${(c.billingAmount || 0).toLocaleString()}</span>
                                        </div>
                                    </div>
                                `).join('') || '<p class="text-center py-10 text-slate-400 italic">No clients found. Go to Settings to seed data.</p>'}
                            </div>
                        </div>
                        <div class="bg-indigo-600 rounded-[2.5rem] p-10 text-white shadow-2xl shadow-indigo-200 overflow-hidden relative flex flex-col justify-between">
                             <div class="z-10"><h4 class="text-indigo-100 font-black text-xs mb-1 uppercase tracking-widest">Growth Analytics</h4><p class="text-3xl font-black">Retention Engine</p></div>
                             <div class="space-y-4 z-10 mt-8">
                                <div class="bg-white/10 backdrop-blur-md p-5 rounded-2xl border border-white/10"><p class="text-[10px] font-bold text-indigo-200 uppercase tracking-widest">Health Score</p><p class="text-2xl font-black">94.8% Stable</p></div>
                                <div class="bg-indigo-500/50 p-5 rounded-2xl border border-white/5"><p class="text-[10px] font-bold text-indigo-200 uppercase tracking-widest">Risk Factor</p><p class="text-2xl font-black">Minimal</p></div>
                             </div>
                        </div>
                    </div>
                `;
                return div;
            },
            statCard(label, value, sub, icon, color) {
                return `
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex items-start gap-4 hover:border-indigo-400 transition-all group">
                        <div class="p-4 bg-slate-50 rounded-2xl group-hover:bg-indigo-50 transition-all"><i data-lucide="${icon}" class="${color} w-6 h-6"></i></div>
                        <div><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">${label}</p><h3 class="text-2xl font-black text-slate-800 tracking-tight">${value}</h3><p class="text-[10px] text-slate-400 font-bold uppercase">${sub}</p></div>
                    </div>`;
            },
            directory() {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-sm animate-in slide-in-from-bottom-4 duration-500';
                const query = state.searchQuery.toLowerCase().trim();
                const filtered = state.clients.filter(c => {
                    const nameMatch = c.name.toLowerCase().includes(query);
                    const emailMatch = c.email.toLowerCase().includes(query);
                    const panMatch = c.pan ? c.pan.toLowerCase().includes(query) : false;
                    const aadharMatch = c.aadhar ? c.aadhar.replace(/\s/g, '').includes(query.replace(/\s/g, '')) : false;
                    return nameMatch || emailMatch || panMatch || aadharMatch;
                });
                div.innerHTML = `
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase tracking-widest border-b">
                            <tr><th class="px-8 py-5">Client Profile</th><th class="px-8 py-5">Compliance</th><th class="px-8 py-5">Annual Value</th><th class="px-8 py-5">Review Cycle</th><th class="px-8 py-5 text-right">Actions</th></tr>
                        </thead>
                        <tbody class="divide-y text-sm">
                            ${filtered.map(c => `
                                <tr onclick="router.navigate('directory', '${c.id}')" class="hover:bg-indigo-50/20 transition-all cursor-pointer group">
                                    <td class="px-8 py-5"><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center font-black text-slate-500 group-hover:bg-indigo-600 group-hover:text-white transition-all">${c.name.charAt(0)}</div><div><p class="font-black text-slate-800">${c.name}</p><p class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">${c.email}</p></div></div></td>
                                    <td class="px-8 py-5"><div class="flex gap-3"><div class="w-1 h-8 rounded-full ${c.pan ? 'bg-indigo-500' : 'bg-slate-200'}"></div><div><p class="text-xs font-black text-slate-700 uppercase tracking-tighter">Verified KYC</p><p class="text-[10px] text-slate-400 font-bold">${c.pan ? 'PAN: ' + c.pan : 'Pending'}</p></div></div></td>
                                    <td class="px-8 py-5"><p class="font-black text-slate-800">₹${(c.billingAmount || 0).toLocaleString()}</p><p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Gross Annual</p></td>
                                    <td class="px-8 py-5"><div class="flex items-center gap-2"><i data-lucide="calendar" class="w-3 h-3 text-slate-300"></i><p class="text-xs font-bold text-slate-600">${c.nextMeeting || 'TBD'}</p></div></td>
                                    <td class="px-8 py-5 text-right"><button class="p-2.5 rounded-xl text-slate-300 hover:text-indigo-600 hover:bg-white border border-transparent hover:border-slate-100 transition-all"><i data-lucide="external-link" class="w-4 h-4"></i></button></td>
                                </tr>`).join('') || `<tr><td colspan="5" class="py-32 text-center text-slate-400 font-bold uppercase tracking-widest text-xs">No records found matching "${query}"</td></tr>`}
                        </tbody>
                    </table>`;
                return div;
            },
            clientDetail(id) {
                const client = state.clients.find(c => c.id === id);
                if (!client) return this.directory();
                const div = document.createElement('div');
                div.className = 'bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-2xl flex flex-col h-full animate-in slide-in-from-bottom-4 duration-500';
                div.innerHTML = `
                    <header class="p-8 bg-slate-50 border-b flex justify-between items-center">
                        <div class="flex gap-6 items-center">
                            <div class="w-24 h-24 rounded-3xl bg-indigo-600 text-white flex items-center justify-center text-4xl font-black shadow-2xl shadow-indigo-200">${client.name.charAt(0)}</div>
                            <div><h2 class="text-3xl font-black text-slate-800 tracking-tight">${client.name}</h2><div class="flex flex-wrap gap-4 mt-2"><span class="flex items-center gap-1.5 text-xs font-bold text-slate-400 bg-white border px-3 py-1 rounded-full"><i data-lucide="mail" class="w-3 h-3 text-indigo-500"></i> ${client.email}</span><span class="flex items-center gap-1.5 text-xs font-bold text-slate-400 bg-white border px-3 py-1 rounded-full"><i data-lucide="phone" class="w-3 h-3 text-indigo-500"></i> ${client.phone}</span><span class="flex items-center gap-1.5 text-xs font-black uppercase tracking-widest px-3 py-1 rounded-full bg-emerald-50 text-emerald-600">${client.status}</span></div></div>
                        </div>
                        <div class="flex gap-3"><button onclick="ui.deleteClient('${id}')" class="p-2.5 text-rose-500 hover:bg-rose-50 rounded-xl transition-all"><i data-lucide="trash-2" class="w-6 h-6"></i></button><button onclick="router.navigate('directory')" class="p-2.5 text-slate-400 hover:bg-slate-200 rounded-xl transition-all"><i data-lucide="x" class="w-6 h-6"></i></button></div>
                    </header>
                    <div class="flex-1 flex overflow-hidden">
                        <aside class="w-64 border-r p-6 space-y-2 bg-slate-50/30">
                            ${this.detailNav('overview', 'Information', 'users')}
                            ${this.detailNav('kyc', 'Compliance', 'shield-check')}
                            ${this.detailNav('docs', 'Files & Documents', 'file-text')}
                            ${this.detailNav('logs', 'Interaction Log', 'history')}
                            ${this.detailNav('billing', 'Billing Ledger', 'credit-card')}
                        </aside>
                        <div class="flex-1 overflow-y-auto p-12 custom-scrollbar" id="detailPanel">${this.renderDetailPanel(client)}</div>
                    </div>`;
                return div;
            },
            detailNav(tab, label, icon) {
                return `<button onclick="ui.setDetailTab('${tab}')" class="w-full flex items-center gap-4 px-5 py-4 rounded-2xl text-[10px] font-black transition-all uppercase tracking-[0.15em] ${state.viewingTab === tab ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-100' : 'text-slate-400 hover:text-slate-900 hover:bg-white/50'}"><i data-lucide="${icon}" class="w-4 h-4"></i> ${label}</button>`;
            },
            renderDetailPanel(client) {
                switch(state.viewingTab) {
                    case 'overview': return `
                        <div class="grid grid-cols-2 gap-x-16 gap-y-10 max-w-4xl animate-in fade-in"> 
                            ${this.detailField('FULL NAME', client.name)} 
                            ${this.detailField('EMAIL ADDRESS', client.email)} 
                            ${this.detailField('CONTACT PHONE', client.phone)} 
                            ${this.detailField('RESIDING CITY', client.city)} 
                            <div class="col-span-2">${this.detailField('KYC ADDRESS', client.address || 'H.No 45, Sector 12, Main Market Road, Near City Center')}</div>
                        </div>`;
                    case 'kyc': return `
                        <div class="grid grid-cols-2 gap-16 max-w-4xl animate-in fade-in">
                            <div class="space-y-10">
                                <h4 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Core Identification</h4>
                                ${this.detailField('PAN NUMBER', client.pan)} 
                                ${this.detailField('AADHAR NUMBER', client.aadhar)}
                            </div>
                            <div class="space-y-10">
                                <h4 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Compliance Status</h4>
                                <div class="bg-emerald-50 text-emerald-700 px-4 py-3 rounded-2xl border border-emerald-100 flex items-center gap-3">
                                    <i data-lucide="shield-check" class="w-5 h-5"></i>
                                    <span class="text-xs font-black uppercase tracking-widest">Fully Compliant & Verified</span>
                                </div>
                            </div>
                        </div>`;
                    case 'docs': return `
                        <div class="space-y-8 animate-in fade-in">
                            <div class="flex justify-between items-center"><h3 class="font-black text-2xl text-slate-800">File Repository</h3><button class="bg-indigo-600 text-white px-6 py-2.5 rounded-xl text-xs font-black">UPLOAD NEW</button></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-5 border border-slate-100 bg-slate-50 rounded-2xl flex items-center justify-between group hover:bg-white hover:shadow-md transition-all">
                                    <div class="flex items-center gap-4"><div class="p-4 bg-white rounded-2xl text-indigo-600 shadow-sm"><i data-lucide="file-text" class="w-5 h-5"></i></div><div><p class="text-sm font-black text-slate-800">KYC_Aadhar_Copy.pdf</p><p class="text-[10px] text-slate-400 uppercase font-black">2.4 MB • Jan 12</p></div></div>
                                    <i data-lucide="download" class="w-4 h-4 text-slate-300"></i>
                                </div>
                                <div class="p-5 border border-slate-100 bg-slate-50 rounded-2xl flex items-center justify-between group hover:bg-white hover:shadow-md transition-all">
                                    <div class="flex items-center gap-4"><div class="p-4 bg-white rounded-2xl text-indigo-600 shadow-sm"><i data-lucide="file-text" class="w-5 h-5"></i></div><div><p class="text-sm font-black text-slate-800">Tax_Invoice_2025.pdf</p><p class="text-[10px] text-slate-400 uppercase font-black">1.1 MB • Jan 02</p></div></div>
                                    <i data-lucide="download" class="w-4 h-4 text-slate-300"></i>
                                </div>
                            </div>
                        </div>`;
                    case 'logs': return `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 max-w-6xl animate-in fade-in">
                            <div class="space-y-6">
                                <div class="bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm space-y-6">
                                    <p class="text-[10px] font-black text-indigo-500 uppercase tracking-[0.2em]">Add Interaction Entry</p>
                                    <input class="w-full bg-slate-50 border border-slate-100 rounded-xl px-5 py-3 text-sm font-bold outline-none" placeholder="Meeting Title">
                                    <textarea class="w-full bg-slate-50 border border-slate-100 rounded-xl px-5 py-3 text-sm h-32 outline-none" placeholder="Notes & Outcomes..."></textarea>
                                    <button class="w-full bg-indigo-600 text-white py-4 rounded-xl text-sm font-black shadow-lg">LOG INTERACTION</button>
                                </div>
                            </div>
                            <div class="space-y-10 relative before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-[2px] before:bg-slate-100 pr-4">
                                <div class="relative pl-12">
                                    <div class="absolute left-0 top-1 w-6 h-6 rounded-full bg-white border-2 border-slate-200 flex items-center justify-center text-slate-300 z-10"><i data-lucide="history" class="w-3 h-3"></i></div>
                                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                        <p class="text-[10px] font-black text-slate-300 uppercase mb-2">Dec 15, 2025</p>
                                        <h5 class="text-sm font-black text-slate-800 uppercase mb-2">Annual Portfolio Review</h5>
                                        <p class="text-xs text-slate-500 leading-relaxed font-medium">Discussed annual targets and asset rebalancing. Client confirmed satisfaction with current growth.</p>
                                    </div>
                                </div>
                                <div class="relative pl-12">
                                    <div class="absolute left-0 top-1 w-6 h-6 rounded-full bg-white border-2 border-slate-200 flex items-center justify-center text-slate-300 z-10"><i data-lucide="history" class="w-3 h-3"></i></div>
                                    <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                        <p class="text-[10px] font-black text-slate-300 uppercase mb-2">Oct 05, 2025</p>
                                        <h5 class="text-sm font-black text-slate-800 uppercase mb-2">Onboarding Completion</h5>
                                        <p class="text-xs text-slate-500 leading-relaxed font-medium">Final documents collected and verified. Portal access shared with primary contact.</p>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    case 'billing': return `
                        <div class="space-y-12 max-w-4xl animate-in fade-in">
                            <div class="grid grid-cols-3 gap-8">
                                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">${this.detailField('ANNUAL BILLING (₹)', '₹' + (client.billingAmount || 0).toLocaleString())}</div>
                                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">${this.detailField('NEXT RENEWAL', client.nextMeeting || 'Feb 20, 2026')}</div>
                                <div class="bg-emerald-600 p-8 rounded-3xl text-white shadow-xl shadow-emerald-100">
                                    <label class="text-[10px] font-black text-emerald-200 uppercase tracking-widest">ACCOUNT STATUS</label>
                                    <p class="text-2xl font-black mt-2 flex items-center gap-2"><i data-lucide="check-circle" class="w-6 h-6"></i> ACTIVE</p>
                                </div>
                            </div>
                        </div>`;
                }
            },
            detailField(label, value) { return `<div class="space-y-2"><label class="text-[10px] font-black text-slate-300 uppercase tracking-widest">${label}</label><p class="text-sm font-black text-slate-800 leading-relaxed tracking-tight">${value || '---'}</p></div>`; },
            settings() {
                const div = document.createElement('div');
                div.className = 'bg-white p-10 rounded-[2.5rem] border border-slate-200 max-w-2xl mx-auto space-y-8 animate-in zoom-in-95 duration-300 shadow-sm';
                div.innerHTML = `
                    <div class="flex items-center gap-4 text-indigo-600"><i data-lucide="database" class="bg-indigo-50 p-3 rounded-2xl w-12 h-12"></i><div><h2 class="text-2xl font-black text-slate-800">Environment Controls</h2><p class="text-sm text-slate-400">Manage testing and presentation data</p></div></div>
                    <div class="p-8 bg-slate-50 rounded-3xl border border-slate-200">
                        <h3 class="font-black text-slate-800 mb-2">Static Seed: 100 Clients</h3>
                        <p class="text-sm text-slate-500 mb-8 leading-relaxed">Instantly populate the CRM with a hardcoded, deterministic list of 100 high-fidelity Indian clients. Ideal for repeatable client walkthroughs.</p>
                        <button onclick="ui.seedData()" id="seedBtn" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black hover:bg-indigo-700 transition-all shadow-xl shadow-indigo-100 flex items-center justify-center gap-3"><i data-lucide="zap" class="w-5 h-5"></i> Generate Full Demo Set</button>
                        <p class="text-[10px] text-center text-slate-400 mt-4 uppercase tracking-widest font-bold">This will overwrite current session data</p>
                    </div>`;
                return div;
            }
        };

        // --- UI Interactions ---
        const ui = {
            toggleModal(id, show) { const modal = document.getElementById(id); modal.classList.toggle('hidden', !show); },
            handleSearch(val) { 
                state.searchQuery = val; 
                if (val.trim().length > 0 && (state.activeTab !== 'directory' || state.selectedClientId !== null)) {
                    router.navigate('directory');
                } else {
                    router.render();
                }
            },
            setDetailTab(tab) { state.viewingTab = tab; router.render(); },
            showToast(msg) {
                const toast = document.getElementById('toast');
                document.getElementById('toastMessage').textContent = msg;
                toast.classList.remove('translate-y-20');
                setTimeout(() => toast.classList.add('translate-y-20'), 3000);
            },
            submitNewClient(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newC = { id: Math.random().toString(36).substr(2, 9), name: formData.get('name'), email: formData.get('email'), phone: formData.get('phone'), pan: formData.get('pan'), aadhar: formData.get('aadhar'), city: formData.get('city'), billingAmount: 75000, status: 'Active', nextMeeting: 'Feb 12, 2026' };
                state.clients.unshift(newC);
                this.toggleModal('addClientModal', false);
                this.showToast('Client registration successful!');
                router.navigate('directory');
            },
            deleteClient(id) { if (confirm('Are you sure you want to remove this client?')) { state.clients = state.clients.filter(c => c.id !== id); this.showToast('Client removed'); router.navigate('directory'); } },
            seedData() {
                const btn = document.getElementById('seedBtn');
                btn.disabled = true; btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Seeding deterministic data...`;
                
                // Deterministic generation
                const list = [];
                for(let i=0; i<100; i++) {
                    const template = STATIC_CLIENTS[i % STATIC_CLIENTS.length];
                    list.push({ ...template, id: 'seed-' + i, name: template.name + ' (' + (i+1) + ')', pan: template.pan.slice(0,-1) + i });
                }
                
                setTimeout(() => {
                    state.clients = list;
                    state.searchQuery = '';
                    document.getElementById('globalSearch').value = '';
                    this.showToast('100 static records generated');
                    router.navigate('directory');
                }, 800);
            }
        };

        window.onload = () => router.navigate('dashboard');
    </script>
</body>
</html>
